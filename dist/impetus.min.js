function _defineProperty(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}const STOP_THRESHOLD_DEFAULT=.3,BOUNCE_DECELERATION=.04,BOUNCE_ACCELERATION=.11;function normalizeEvent(t){if("touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type){const[i]=t.changedTouches;return{x:i.clientX,y:i.clientY,id:i.identifier}}return{x:t.clientX,y:t.clientY,id:null}}"undefined"!=typeof window&&window.addEventListener("touchmove",()=>{});const dragOutOfBoundsMultiplier=t=>5e-6*t**2+1e-4*t+.55;export default class Impetus{constructor({source:t=document,update:i,multiplier:e=1,friction:n=.92,bounce:o=!0,boundX:s,boundY:r,initialValues:p,onDown:h,onUp:l}){_defineProperty(this,"callUpdateCallback",()=>this.updateCallback(this.options)),_defineProperty(this,"startDecelAnim",()=>{const{multiplier:t,trackingPoints:i}=this.options,[e]=i,n=i[i.length-1],o=n.x-e.x,s=n.y-e.y,r=(n.time-e.time)/15/t;this.options.decVelX=o/r||0,this.options.decVelY=s/r||0;const p=this.checkBounds();(Math.abs(this.options.decVelX)>1||Math.abs(this.options.decVelY)>1||!p.inBounds)&&(this.options.decelerating=!0,this.stepDecelRaf=requestAnimationFrame(this.stepDecelAnim))}),_defineProperty(this,"stepDecelAnim",()=>{this.stepDecelRaf=null;const{bounce:t,decelerating:i,friction:e,stopThreshold:n}=this.options;if(!i)return;this.options.decVelX*=e,this.options.decVelY*=e,this.options.targetX+=this.options.decVelX,this.options.targetY+=this.options.decVelY;const o=this.checkBounds();if(Math.abs(this.options.decVelX)<=n&&Math.abs(this.options.decVelY)<=n&&o.inBounds)this.options.decelerating=!1;else{if(t){const t=2.5;if(0!==o.x)if(o.x*this.options.decVelX<=0)this.options.decVelX+=o.x*BOUNCE_DECELERATION;else{const i=o.x>0?t:-t;this.options.decVelX=(o.x+i)*BOUNCE_ACCELERATION}if(0!==o.y)if(o.y*this.options.decVelY<=0)this.options.decVelY+=o.y*BOUNCE_DECELERATION;else{const i=o.y>0?t:-t;this.options.decVelY=(o.y+i)*BOUNCE_ACCELERATION}}else 0!==o.x&&(o.x>0?this.options.targetX=this.options.boundXmin:this.options.targetX=this.options.boundXmax,this.options.decVelX=0),0!==o.y&&(o.y>0?this.options.targetY=this.options.boundYmin:this.options.targetY=this.options.boundYmax,this.options.decVelY=0);this.callUpdateCallback(),this.stepDecelRaf=requestAnimationFrame(this.stepDecelAnim)}}),_defineProperty(this,"addTrackingPoint",(t,i)=>{const e=Date.now();for(;this.options.trackingPoints.length>0&&!(e-this.options.trackingPoints[0].time<=100);)this.options.trackingPoints.shift();this.options.trackingPoints.push({x:t,y:i,time:e})}),_defineProperty(this,"requestTick",()=>{this.options.ticking||(this.tickRaf=requestAnimationFrame(this.updateAndRender)),this.options.ticking=!0}),_defineProperty(this,"checkBounds",t=>{const{boundXmin:i,boundXmax:e,boundYmin:n,boundYmax:o,targetX:s,targetY:r}=this.options;let p=0,h=0;return null!=i&&s<i?p=i-s:null!=e&&s>e&&(p=e-s),null!=n&&r<n?h=n-r:null!=o&&r>o&&(h=o-r),t&&(0!==p&&(this.options.targetX=p>0?i:e),0!==h&&(this.options.targetY=h>0?n:o)),{x:p,y:h,inBounds:0===p&&0===h}}),_defineProperty(this,"updateAndRender",()=>{this.tickRaf=null;const{bounce:t,multiplier:i,pointerCurrentX:e,pointerCurrentY:n,pointerLastX:o,pointerLastY:s}=this.options,r=e-o,p=n-s;if(this.options.targetX+=r*i,this.options.targetY+=p*i,t){const t=this.checkBounds();0!==t.x&&(this.options.targetX-=r*dragOutOfBoundsMultiplier(t.x)*i),0!==t.y&&(this.options.targetY-=p*dragOutOfBoundsMultiplier(t.y)*i)}else this.checkBounds(!0);this.callUpdateCallback(),this.options.pointerLastX=e,this.options.pointerLastY=n,this.options.ticking=!1}),_defineProperty(this,"onWheel",t=>{this.options.targetX-=t.deltaX/3,this.options.targetY-=t.deltaY/3,this.options.decelerating=!0,this.callUpdateCallback(),this.options.decelerating=!1}),_defineProperty(this,"onMove",t=>{t.preventDefault();const i=normalizeEvent(t);this.options.pointerActive&&i.id===this.options.pointerId&&(null!=t.deltaX?(this.options.pointerCurrentX=i.x+i.deltaX,this.options.pointerCurrentY=i.y+i.deltaY):(this.options.pointerCurrentX=i.x,this.options.pointerCurrentY=i.y),this.addTrackingPoint(this.options.pointerLastX,this.options.pointerLastY),this.requestTick())}),_defineProperty(this,"onDown",t=>{const i=normalizeEvent(t);this.options.pointerActive||this.options.paused||(this.options.onDown&&this.options.onDown(),this.options.pointerActive=!0,this.options.decelerating=!1,this.options.pointerId=i.id,this.options.pointerCurrentX=i.x,this.options.pointerCurrentY=i.y,this.options.pointerLastX=i.x,this.options.pointerLastY=i.y,this.options.trackingPoints=[],this.addTrackingPoint(this.options.pointerLastX,this.options.pointerLastY),document.addEventListener("mousemove",this.onMove,this.eventOptions),document.addEventListener("touchmove",this.onMove,this.eventOptions),document.addEventListener("touchcancel",this.stopTracking),document.addEventListener("touchend",this.onUp),document.addEventListener("mouseup",this.onUp))}),_defineProperty(this,"stopTracking",()=>{this.options.pointerActive=!1,this.addTrackingPoint(this.options.pointerLastX,this.options.pointerLastY),this.startDecelAnim(),this.removeEventListeners()}),_defineProperty(this,"removeEventListeners",()=>{document.removeEventListener("mousemove",this.onMove,this.eventOptions),document.removeEventListener("touchmove",this.onMove,this.eventOptions),document.removeEventListener("touchend",this.onUp),document.removeEventListener("touchcancel",this.stopTracking),document.removeEventListener("mouseup",this.onUp)}),_defineProperty(this,"onUp",t=>{const i=normalizeEvent(t);this.options.pointerActive&&i.id===this.options.pointerId&&(this.options.onUp&&this.options.onUp(),this.stopTracking())}),_defineProperty(this,"destroy",()=>(window.removeEventListener("wheel",this.onWheel,this.eventOptions),this.sourceEl.removeEventListener("touchstart",this.onDown),this.sourceEl.removeEventListener("mousedown",this.onDown),this.sourceEl=null,null)),_defineProperty(this,"pause",()=>{this.options.pointerActive=!1,this.options.paused=!0}),_defineProperty(this,"resume",()=>{this.options.paused=!1}),_defineProperty(this,"setValue",(t,i)=>{"number"==typeof t&&(this.options.targetX=t),"number"==typeof i&&(this.options.targetY=i)}),_defineProperty(this,"setMultiplier",t=>{this.options.multiplier=t,this.options.stopThreshold=STOP_THRESHOLD_DEFAULT*this.options.multiplier}),_defineProperty(this,"setBoundX",([t,i])=>{this.options.boundXmin=t,this.options.boundXmax=i}),_defineProperty(this,"setBoundY",([t,i])=>{this.options.boundYmin=t,this.options.boundYmax=i}),_defineProperty(this,"cancel",()=>{this.options.decelerating=!1,this.options.pointerActive=!1,this.options.ticking=!1,this.options.decVelX=0,this.options.decVelY=0,this.removeEventListeners(),this.stepDecelRaf&&(cancelAnimationFrame(this.stepDecelRaf),this.stepDecelRaf=null),this.tickRaf&&(cancelAnimationFrame(this.tickRaf),this.tickRaf=null)}),this.updateCallback=i,this.stepDecelRaf=null,this.tickRaf=null,this.options={bounce:o,friction:n,multiplier:e,onDown:h,onUp:l,stopThreshold:STOP_THRESHOLD_DEFAULT*e,targetX:0,targetY:0,paused:!1,ticking:!1,decelerating:!1,pointerActive:!1,trackingPoints:[],pointerCurrentX:null,pointerCurrentY:null,pointerLastX:null,pointerLastY:null,boundXmin:null,boundXmax:null,boundYmin:null,boundYmax:null,pointerId:null,decVelX:null,decVelY:null};let c=!0;try{const t=Object.defineProperty({},"passive",{get:()=>!0});window.addEventListener("test",null,t)}catch(t){c=!1}if(this.eventOptions=!!c&&{passive:!1},this.sourceEl="string"==typeof t?document.querySelector(t):t,!this.sourceEl)throw new Error("IMPETUS: source not found.");if(!this.updateCallback)throw new Error("IMPETUS: update function not defined.");if(p){const[t,i]=p;t&&(this.options.targetX=t),i&&(this.options.targetY=i),this.callUpdateCallback()}if(s){const[t,i]=s;this.options.boundXmin=t,this.options.boundXmax=i}if(r){const[t,i]=r;this.options.boundYmin=t,this.options.boundYmax=i}this.sourceEl.addEventListener("touchstart",this.onDown),this.sourceEl.addEventListener("mousedown",this.onDown),window.addEventListener("wheel",this.onWheel,this.eventOptions)}};